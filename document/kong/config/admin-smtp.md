# Admin SMTP Configuration

## 개요

Kong Admin SMTP 설정은 관리자 이메일 알림과 감사 로깅을 위한 SMTP 서버 구성과 관련된 설정들을 포함합니다. 이를 통해 Kong 관리자들에게 중요한 이벤트나 알림을 이메일로 전송할 수 있습니다.

## Admin 이메일 설정

| 설정                      | 설명                                                                | 기본값   |
| ------------------------- | ------------------------------------------------------------------- | -------- |
| `admin_emails_from`       | 관리자 이메일의 From 헤더에 사용할 이메일 주소입니다.               | `""`     |
| `admin_emails_reply_to`   | 관리자 이메일의 Reply-To 헤더에 사용할 이메일 주소입니다.           | -        |
| `admin_invitation_expiry` | 관리자 초대 링크의 만료 시간(초)입니다. 0은 만료 없음을 의미합니다. | `259200` |

### admin_invitation_expiry 예시

- **72시간**: `72 * 60 * 60 = 259200`
- **24시간**: `24 * 60 * 60 = 86400`
- **7일**: `7 * 24 * 60 * 60 = 604800`

## 일반 SMTP 설정

| 설정             | 설명                                                                                                                 | 기본값                  |
| ---------------- | -------------------------------------------------------------------------------------------------------------------- | ----------------------- |
| `smtp_mock`      | 이 플래그는 이메일 전송을 모의합니다. SMTP 클라이언트가 완전히 구성되기 전에 테스트하는 데 사용할 수 있습니다.       | `on`                    |
| `smtp_host`      | 연결할 SMTP 서버의 호스트명입니다.                                                                                   | `localhost`             |
| `smtp_port`      | 연결할 SMTP 서버의 포트 번호입니다.                                                                                  | `25`                    |
| `smtp_starttls`  | `on`으로 설정하면 SMTP 서버와의 통신을 암호화하기 위해 STARTTLS가 사용됩니다. 일반적으로 포트 587과 함께 사용됩니다. | `off`                   |
| `smtp_ssl`       | `on`으로 설정하면 SMTP 서버와의 통신을 암호화하기 위해 SMTPS가 사용됩니다. 일반적으로 포트 465와 함께 사용됩니다.    | `off`                   |
| `smtp_username`  | SMTP 서버 인증에 사용되는 사용자명입니다.                                                                            | -                       |
| `smtp_password`  | SMTP 서버 인증에 사용되는 비밀번호입니다.                                                                            | -                       |
| `smtp_auth_type` | SMTP 서버 인증에 사용되는 방법입니다.                                                                                | -                       |
| `smtp_domain`    | EHLO 연결과 Message-ID 헤더의 일부에 사용되는 도메인입니다.                                                          | `localhost.localdomain` |

### SMTP 인증 타입

`smtp_auth_type`의 유효한 값:

- `plain`: 일반 텍스트 인증
- `login`: 로그인 인증
- `nil`: 인증 없음

### SMTP 포트 및 암호화

| 포트 | 암호화 방식 | 설명                               |
| ---- | ----------- | ---------------------------------- |
| 25   | 없음        | 기본 SMTP 포트 (일반적으로 차단됨) |
| 587  | STARTTLS    | 제출 포트 (권장)                   |
| 465  | SSL/TLS     | 암호화된 SMTP 포트                 |

## SMTP 타임아웃 설정

| 설정                   | 설명                                                  | 기본값  |
| ---------------------- | ----------------------------------------------------- | ------- |
| `smtp_timeout_connect` | SMTP 서버에 연결하는 타임아웃(밀리초)입니다.          | `60000` |
| `smtp_timeout_send`    | SMTP 서버에 데이터를 전송하는 타임아웃(밀리초)입니다. | `60000` |
| `smtp_timeout_read`    | SMTP 서버에서 데이터를 읽는 타임아웃(밀리초)입니다.   | `60000` |

## 관리자 이메일 알림 설정

| 설정                | 설명                                                  | 기본값 |
| ------------------- | ----------------------------------------------------- | ------ |
| `smtp_admin_emails` | 알림을 받을 관리자 이메일의 쉼표로 구분된 목록입니다. | -      |

**예시**: `admin1@example.com, admin2@example.com`

## 감사 로그 설정

### 기본 감사 로그 설정

| 설정        | 설명                                                                                                | 기본값 |
| ----------- | --------------------------------------------------------------------------------------------------- | ------ |
| `audit_log` | 활성화되면 Kong이 Admin API 액세스와 데이터베이스 행 삽입, 업데이트, 삭제에 대한 정보를 로그합니다. | `off`  |

### 감사 로그 필터링 설정

| 설정                        | 설명                                                                                       | 기본값                            |
| --------------------------- | ------------------------------------------------------------------------------------------ | --------------------------------- |
| `audit_log_ignore_methods`  | 감사 로그 항목을 생성하지 않을 HTTP 메서드의 쉼표로 구분된 목록입니다.                     | -                                 |
| `audit_log_ignore_paths`    | 감사 로그 항목을 생성하지 않을 요청 경로의 쉼표로 구분된 목록입니다.                       | -                                 |
| `audit_log_ignore_tables`   | 감사 로그 항목을 생성하지 않을 데이터베이스 테이블의 쉼표로 구분된 목록입니다.             | -                                 |
| `audit_log_payload_exclude` | 페이로드에서 필터링될 키의 쉼표로 구분된 목록입니다. 필터링된 키는 감사 로그에 기록됩니다. | `["token", "secret", "password"]` |

### 감사 로그 보존 설정

| 설정                    | 설명                                                                                               | 기본값    |
| ----------------------- | -------------------------------------------------------------------------------------------------- | --------- |
| `audit_log_record_ttl`  | 감사 로그 레코드의 TTL 길이(초)입니다. TTL보다 오래된 데이터베이스의 레코드는 자동으로 제거됩니다. | `2592000` |
| `audit_log_signing_key` | 감사 레코드의 서명을 삽입하는 데 사용할 수 있는 개인 RSA 서명 키의 경로를 정의합니다.              | -         |

### audit_log_record_ttl 예시

- **30일**: `30 * 24 * 60 * 60 = 2592000`
- **7일**: `7 * 24 * 60 * 60 = 604800`
- **90일**: `90 * 24 * 60 * 60 = 7776000`

## 감사 로그 보안

### 서명 키 설정

`audit_log_signing_key`를 사용하여 감사 레코드에 디지털 서명을 추가할 수 있습니다:

- **개인 키**: Kong 서버에 저장되어 레코드 서명에 사용
- **공개 키**: 오프라인에 저장되어 향후 감사 항목 검증에 사용
- **서명 없음**: 이 값이 정의되지 않으면 서명이 생성되지 않습니다

### 민감한 데이터 보호

기본적으로 다음 키들이 페이로드에서 자동으로 필터링됩니다:

- `token`
- `secret`
- `password`

## SMTP 구성 예시

### Gmail SMTP 설정

```yaml
smtp_mock: off
smtp_host: smtp.gmail.com
smtp_port: 587
smtp_starttls: on
smtp_username: your-email@gmail.com
smtp_password: your-app-password
smtp_auth_type: login
```

### AWS SES 설정

```yaml
smtp_mock: off
smtp_host: email-smtp.us-west-2.amazonaws.com
smtp_port: 587
smtp_starttls: on
smtp_username: your-ses-username
smtp_password: your-ses-password
smtp_auth_type: login
```

### SendGrid 설정

```yaml
smtp_mock: off
smtp_host: smtp.sendgrid.net
smtp_port: 587
smtp_starttls: on
smtp_username: apikey
smtp_password: your-sendgrid-api-key
smtp_auth_type: login
```

## 운영 권장사항

### 보안 고려사항

- **SMTP 인증**: 가능한 경우 SMTP 인증을 사용하세요
- **암호화**: 프로덕션 환경에서는 STARTTLS 또는 SSL을 사용하세요
- **비밀번호 보안**: SMTP 비밀번호를 안전하게 저장하세요
- **감사 로그 서명**: 중요한 환경에서는 감사 로그 서명을 활성화하세요

### 성능 최적화

- **타임아웃 설정**: 네트워크 환경에 맞게 타임아웃을 조정하세요
- **감사 로그 TTL**: 저장 공간을 고려하여 적절한 TTL을 설정하세요
- **필터링**: 불필요한 감사 로그 생성을 방지하기 위해 적절한 필터를 설정하세요

### 모니터링

- **이메일 전송 상태**: SMTP 서버 연결 상태를 모니터링하세요
- **감사 로그 크기**: 데이터베이스의 감사 로그 크기를 모니터링하세요
- **오류 로그**: SMTP 전송 오류를 모니터링하세요
