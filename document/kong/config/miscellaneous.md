# Miscellaneous

## 개요

Miscellaneous 설정은 lua-nginx-module에서 상속된 추가 설정으로, 더 많은 유연성과 고급 사용을 가능하게 합니다.

### 참고 자료

더 자세한 정보는 lua-nginx-module 문서를 참조하세요: https://github.com/openresty/lua-nginx-module

## SSL/TLS 설정

### Lua SSL 설정

| 설정                          | 설명                                                                                         | 기본값            |
| ----------------------------- | -------------------------------------------------------------------------------------------- | ----------------- |
| `lua_ssl_trusted_certificate` | Lua cosocket용 PEM 형식의 인증 기관 인증서의 쉼표로 구분된 목록입니다.                       | `system`          |
| `lua_ssl_verify_depth`        | `lua_ssl_trusted_certificate`로 설정된 서버 인증서 체인에서 사용되는 검증 깊이를 설정합니다. | `1`               |
| `lua_ssl_protocols`           | OpenResty의 TCP cosocket API와 핸드셰이크할 때 지원되는 TLS 버전을 정의합니다.               | `TLSv1.2 TLSv1.3` |

### lua_ssl_trusted_certificate 특별 값

`system` 값은 각 배포판에서 제공하는 "일반적인 기본값"을 검색하려고 시도합니다. 현재 구현에서는 다음 경로명이 순서대로 테스트되고, 찾은 첫 번째 경로가 사용됩니다:

| 배포판               | 경로                                                |
| -------------------- | --------------------------------------------------- |
| Debian/Ubuntu/Gentoo | `/etc/ssl/certs/ca-certificates.crt`                |
| Fedora/RHEL 6        | `/etc/pki/tls/certs/ca-bundle.crt`                  |
| OpenSUSE             | `/etc/ssl/ca-bundle.pem`                            |
| OpenELEC             | `/etc/pki/tls/cacert.pem`                           |
| CentOS/RHEL 7        | `/etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem` |
| OpenBSD, Alpine      | `/etc/ssl/cert.pem`                                 |

### 인증서 설정 방법

`lua_ssl_trusted_certificate`는 다음 값 중 하나로 구성할 수 있습니다:

- **`system`**: 시스템 기본 CA 인증서 사용
- **인증서의 절대 경로**
- **인증서 내용**
- **base64로 인코딩된 인증서 내용**

### SSL 검증 깊이 설명

- **목적**: 인증서 기반 DoS 공격을 완화하는 데 도움이 됩니다
- **동작**: 체인의 끝에 도달하기 전에 최대 깊이에 도달하면 검증이 실패합니다
- **데이터베이스 연결**: `pg_ssl_verify`가 활성화되면 Kong의 데이터베이스 연결 검증에도 사용됩니다

### TLS 프로토콜 영향 범위

이 설정은 다음 연결에 영향을 줍니다:

- **Lua 코드로 만든 연결**: Kong이 사용하는 데이터베이스 연결
- **로깅 플러그인**: 로그 전송 시 연결

**영향을 받지 않는 연결**:

- **Upstream Service 연결**: 업스트림 서비스로의 연결
- **다운스트림 클라이언트**: 클라이언트로부터의 연결

## Lua 모듈 설정

### 패키지 경로 설정

| 설정                | 설명                                                                                                                              | 기본값                  |
| ------------------- | --------------------------------------------------------------------------------------------------------------------------------- | ----------------------- |
| `lua_package_path`  | Lua 모듈 검색 경로(LUA_PATH)를 설정합니다. 기본 검색 경로에 저장되지 않은 사용자 정의 플러그인을 개발하거나 사용할 때 유용합니다. | `./?.lua;./?/init.lua;` |
| `lua_package_cpath` | Lua C 모듈 검색 경로(LUA_CPATH)를 설정합니다.                                                                                     | -                       |

### 패키지 경로 사용 사례

- **사용자 정의 플러그인**: 기본 경로에 없는 플러그인 사용
- **개발 환경**: 로컬 개발 중 모듈 경로 설정
- **커스텀 라이브러리**: 프로젝트별 Lua 라이브러리 사용

## 소켓 풀 설정

| 설정                   | 설명                                                                    | 기본값 |
| ---------------------- | ----------------------------------------------------------------------- | ------ |
| `lua_socket_pool_size` | 모든 원격 서버와 연결된 모든 cosocket 연결 풀의 크기 제한을 지정합니다. | `256`  |

### 소켓 풀 크기 고려사항

- **메모리 사용량**: 풀 크기가 클수록 더 많은 메모리를 사용합니다
- **연결 재사용**: 풀 크기가 클수록 연결 재사용이 증가합니다
- **성능**: 적절한 풀 크기는 성능에 영향을 줍니다

## RBAC (Role-Based Access Control) 설정

### RBAC 기본 설정

| 설정               | 설명                                                                            | 기본값             |
| ------------------ | ------------------------------------------------------------------------------- | ------------------ |
| `enforce_rbac`     | Admin API RBAC가 적용되는지 지정합니다.                                         | `off`              |
| `rbac_auth_header` | Admin API가 RBAC 사용자를 인증하려고 시도할 HTTP 요청 헤더의 이름을 정의합니다. | `Kong-Admin-Token` |

### enforce_rbac 유효한 값

| 값       | 설명                                                       |
| -------- | ---------------------------------------------------------- |
| `on`     | 엔드포인트 수준 권한 부여만 적용됩니다.                    |
| `entity` | 엔티티 수준 권한 부여가 적용됩니다.                        |
| `both`   | 엔드포인트 및 엔티티 수준 권한 부여를 모두 활성화합니다.   |
| `off`    | 엔드포인트 및 엔티티 수준 권한 부여를 모두 비활성화합니다. |

### RBAC 동작

RBAC가 활성화되면 Kong은 다음 경우에 Admin API 요청을 거부합니다:

- **유효하지 않은 토큰**: 존재하지 않거나 유효하지 않은 RBAC 인증 토큰이 전달된 경우
- **권한 부족**: 토큰과 연결된 RBAC 사용자가 요청된 리소스에 접근/수정할 권한이 없는 경우

## 이벤트 훅 설정

| 설정                  | 설명                                                                                        | 기본값 |
| --------------------- | ------------------------------------------------------------------------------------------- | ------ |
| `event_hooks_enabled` | 활성화되면 이벤트 훅 엔티티가 이벤트(소스 및 이벤트)와 액션(핸들러) 간의 관계를 나타냅니다. | `on`   |

### 이벤트 훅 기능

- **웹훅과 유사**: Kong Gateway 서비스 이벤트를 전달하는 데 사용할 수 있습니다
- **이벤트 트리거**: 특정 이벤트가 서비스에서 발생하면 이벤트 훅이 해당 이벤트에 대한 정보와 함께 URL을 호출합니다
- **핸들러별 구성**: 이벤트 훅 구성은 핸들러에 따라 다릅니다
- **연관 데이터 전송**: 트리거되는 이벤트는 연관된 데이터를 전송합니다

### 이벤트 훅 사용 사례

- **서비스 모니터링**: 서비스 상태 변경 알림
- **로깅**: 이벤트 기반 로그 수집
- **통합**: 외부 시스템과의 이벤트 기반 통합
- **알림**: 관리자에게 중요한 이벤트 알림

## FIPS 모드 설정

| 설정   | 설명                                                              | 기본값 |
| ------ | ----------------------------------------------------------------- | ------ |
| `fips` | FIPS 모드를 켭니다. 이 모드는 FIPS 빌드에서만 사용할 수 있습니다. | `off`  |

### FIPS 모드 특징

- **보안 표준**: Federal Information Processing Standards 준수
- **암호화**: FIPS 140-2 인증 암호화 모듈 사용
- **제한사항**: FIPS 빌드에서만 사용 가능
- **정부 요구사항**: 정부 및 규제 환경에서 요구되는 보안 표준

## 보안 고려사항

### SSL/TLS 보안

- **인증서 검증**: 적절한 CA 인증서를 사용하여 SSL 검증을 설정하세요
- **프로토콜 버전**: 최신 TLS 버전을 사용하세요
- **검증 깊이**: 적절한 검증 깊이를 설정하여 DoS 공격을 방지하세요

### RBAC 보안

- **토큰 관리**: RBAC 토큰을 안전하게 관리하세요
- **권한 최소화**: 필요한 최소한의 권한만 부여하세요
- **정기적 검토**: 사용자 권한을 정기적으로 검토하세요

### 이벤트 훅 보안

- **엔드포인트 보안**: 이벤트 훅 엔드포인트를 보호하세요
- **데이터 검증**: 수신된 이벤트 데이터를 검증하세요
- **로깅**: 이벤트 훅 활동을 모니터링하세요

## 운영 권장사항

### SSL/TLS 관리

- **인증서 갱신**: CA 인증서를 정기적으로 갱신하세요
- **프로토콜 모니터링**: TLS 프로토콜 사용을 모니터링하세요
- **검증 오류**: SSL 검증 오류를 추적하세요

### RBAC 관리

- **사용자 관리**: RBAC 사용자를 체계적으로 관리하세요
- **권한 감사**: 정기적으로 권한을 감사하세요
- **토큰 로테이션**: 정기적으로 RBAC 토큰을 로테이션하세요

### 이벤트 훅 관리

- **엔드포인트 모니터링**: 이벤트 훅 엔드포인트의 가용성을 모니터링하세요
- **성능 모니터링**: 이벤트 훅 처리 성능을 모니터링하세요
- **오류 처리**: 이벤트 훅 오류를 적절히 처리하세요

### FIPS 모드 운영

- **호환성 확인**: FIPS 모드와 호환되는 플러그인만 사용하세요
- **성능 모니터링**: FIPS 모드의 성능 영향을 모니터링하세요
- **규정 준수**: FIPS 요구사항을 지속적으로 준수하세요
